<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hudson Valley Lyme Risk Score</title>
    <meta name="google-site-verification" content="EdTiTb32BQdG10T38Ag4P7LuN-MymFb4k1G71GaUad0" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8f9fa;
            padding: 2rem;
        }
        
        .risk-container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .risk-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .risk-header h1 {
            color: #2c5f2d;
            margin-bottom: 0.5rem;
        }
        
        .risk-header p {
            color: #666;
            font-size: 0.95rem;
        }
        
        .counties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .county-card {
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            color: white;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .county-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.15);
        }
        
        .county-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }
        
        .risk-score {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.3rem;
        }
        
        .risk-label {
            font-size: 0.85rem;
            opacity: 0.9;
        }
        
        .risk-percent {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 0.5rem;
        }
        
        /* Risk score colors */
        .risk-1 { background: linear-gradient(135deg, #FFD700, #FFC700); }
        .risk-2 { background: linear-gradient(135deg, #FFA500, #FF8C00); }
        .risk-3 { background: linear-gradient(135deg, #FF6347, #FF4500); }
        .risk-4 { background: linear-gradient(135deg, #DC143C, #B22222); }
        .risk-5 { background: linear-gradient(135deg, #8B0000, #660000); }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #999;
        }
        
        .disclaimer {
            background: #f0f7ff;
            border-left: 4px solid #2c5f2d;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 4px;
            font-size: 0.9rem;
            color: #333;
            line-height: 1.6;
        }
        
        .ny-map-link {
            text-align: center;
            margin-top: 2rem;
        }
        
        .ny-map-link a {
            display: inline-block;
            background: #2c5f2d;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: background 0.3s;
        }
        
        .ny-map-link a:hover {
            background: #1e4620;
        }
    </style>
</head>
<body>
    <div class="risk-container">
        <div class="risk-header">
            <h1>üî¥ Hudson Valley Lyme Risk Scores</h1>
            <p>Live infection rates based on NY State Department of Health tick surveillance data</p>
        </div>
        
        <div id="tick-risk-container" class="loading">
            <p>Loading risk data...</p>
        </div>
        
        <div class="disclaimer">
            <strong>‚ö†Ô∏è Important:</strong> Risk scores are based on actual tick infection rates from recent NY State surveillance. Infection percentages show what percentage of collected ticks tested positive for Lyme disease. Always take precautions to avoid tick bites, especially during peak season (May-September for nymphs, March-May and October-November for adults). Contact your healthcare provider immediately if you develop a rash or flu-like symptoms after outdoor exposure.
        </div>
        
        <div class="ny-map-link">
            <a href="https://www.health.ny.gov/diseases/communicable/lyme/risk_score_map.htm" target="_blank">
                View Official NY State Interactive Map ‚Üí
            </a>
        </div>
    </div>
    
    <script>
        const HV_COUNTIES = ['Putnam', 'Dutchess', 'Rockland', 'Westchester', 'Columbia', 'Ulster', 'Orange'];
        
        async function fetchTickRiskData() {
            try {
                const url = "https://health.data.ny.gov/api/views/kibp-u2ip/rows.csv?$limit=10000";
                
                const response = await fetch(url, {
                    headers: { 'Accept': 'text/csv' }
                });
                
                if (!response.ok) {
                    console.error('API response status:', response.status);
                    return null;
                }
                
                const csv = await response.text();
                const lines = csv.split('\n');
                const riskScores = {};
                
                // Initialize all HV counties
                HV_COUNTIES.forEach(county => {
                    riskScores[county] = { infected: 0, tested: 0 };
                });
                
                // Parse CSV and aggregate data
                lines.forEach((line, index) => {
                    if (index === 0 || !line.trim()) return;
                    const cols = line.split(',');
                    const county = cols[9]?.trim().replace(/"/g, '');
                    const infected = parseInt(cols[13]) || 0;
                    const tested = parseInt(cols[12]) || 0;
                    
                    if (HV_COUNTIES.includes(county)) {
                        if (!riskScores[county]) {
                            riskScores[county] = { infected: 0, tested: 0 };
                        }
                        riskScores[county].infected += infected;
                        riskScores[county].tested += tested;
                    }
                });
                
                // Calculate percentages and risk levels
                Object.keys(riskScores).forEach(county => {
                    const data = riskScores[county];
                    if (data.tested > 0) {
                        data.percentInfected = (data.infected / data.tested * 100).toFixed(1);
                        data.riskLevel = calculateRiskLevel(data.percentInfected);
                    } else {
                        data.percentInfected = 'N/A';
                        data.riskLevel = {score: 0, label: 'No Data', color: '#ccc'};
                    }
                });
                
                return riskScores;
            } catch (error) {
                console.error('Error fetching tick data:', error);
                return null;
            }
        }
        
        function calculateRiskLevel(percentInfected) {
            const percent = parseFloat(percentInfected);
            if (percent < 5) return {score: 1, label: 'Low', color: '#FFD700'};
            if (percent < 15) return {score: 2, label: 'Moderate', color: '#FFA500'};
            if (percent < 30) return {score: 3, label: 'High', color: '#FF6347'};
            if (percent < 50) return {score: 4, label: 'Very High', color: '#DC143C'};
            return {score: 5, label: 'Extreme', color: '#8B0000'};
        }
        
        async function displayRiskScores() {
            const riskData = await fetchTickRiskData();
            const container = document.getElementById('tick-risk-container');
            
            if (!riskData) {
                container.innerHTML = '<p style="color: #999;">Unable to load live data. Please try refreshing.</p>';
                return;
            }
            
            let html = '<div class="counties-grid">';
            
            HV_COUNTIES.forEach(county => {
                const data = riskData[county];
                const color = data.riskLevel?.color || '#ccc';
                html += `
                    <div class="county-card risk-${data.riskLevel?.score || 0}" style="background: ${color};">
                        <div class="county-name">${county} County</div>
                        <div class="risk-score">${data.riskLevel?.score || '‚Äî'}</div>
                        <div class="risk-label">${data.riskLevel?.label || 'No Data'}</div>
                        ${data.percentInfected !== 'N/A' ? `<div class="risk-percent">${data.percentInfected}% infected (n=${data.tested})</div>` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', displayRiskScores);
        } else {
            displayRiskScores();
        }
    </script>
</body>
</html>
